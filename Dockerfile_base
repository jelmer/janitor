FROM debian:testing-slim
MAINTAINER Jelmer Vernooij <jelmer@debian.org>

RUN apt -y update && apt -y upgrade && apt install --no-install-recommends -y python3 python3-fastbencode git python3-tqdm rustc libpython3-dev cargo cython3 python3-distro-info python3-patiencediff python3-aiohttp python3-configobj python3-jinja2 python3-debian python3-requirement-parser python3-asyncpg python3-protobuf protobuf-compiler python3-yaml python3-prometheus-client python3-gpg python3-cffi python3-future python3-cryptography python3-pycparser python3-pip python3-rsa python3-jwt python3-aiofiles python3-chardet python3-urllib3 python3-apt python3-iso8601 make python3-aiozipkin python3-setuptools-rust python3-aiohttp-openmetrics mypy-protobuf && pip3 install gcloud-aio-storage google-cloud-logging git+https://github.com/maximdanilchenko/aiohttp-apispec git+https://salsa.debian.org/python-debian-team/python-debian
ENV BRZ_PLUGINS_AT=debian@/code/breezy-debian
ENV PYTHONPATH=/code:/code/breezy:/code/dulwich:/code/debmutate:/code/silver-platter:/code/upstream-ontologist:/code/buildlog-consultant:/code/ognibuild:/code/lintian-brush
ADD . /code
RUN make -C /code
