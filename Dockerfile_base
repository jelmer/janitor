FROM debian:sid-slim
MAINTAINER Jelmer Vernooij <jelmer@debian.org>

RUN echo "deb http://incoming.debian.org/debian-buildd/ buildd-unstable main" >> /etc/apt/sources.list.d/incoming.list && apt -y update && apt -y upgrade
RUN apt satisfy --no-install-recommends -y \
	python3 \
	python3-fastbencode \
	git \
	python3-tqdm \
	rustc \
	libpython3-dev \
	cargo \
	cython3 \
	python3-distro-info \
	python3-patiencediff \
	python3-aiohttp \
	python3-configobj \
	python3-jinja2 \
	"python3-debian (>= 0.1.47)" \
	python3-requirement-parser \
	python3-asyncpg \
	python3-protobuf \
	protobuf-compiler \
	mypy-protobuf \
	python3-yaml \
	python3-gpg \
	python3-cffi \
	python3-future \
	python3-cryptography \
	python3-pycparser \
	python3-pip \
	python3-rsa \
	python3-jwt \
	python3-aiofiles \
	python3-chardet \
	python3-urllib3 \
	python3-apt \
	python3-iso8601 \
	python3-pcre \
	python3-aioredis \
	make \
	python3-aiozipkin \
	python3-setuptools-rust \
	python3-aiohttp-openmetrics \
	python3-apispec python3-webargs \
	python3-typeshed \
	python3-aiohttp-apispec \
	python3-merge3 \
	wget \
	ca-certificates \
	&& pip3 install --upgrade gcloud-aio-storage google-cloud-logging git+https://github.com/jelmer/aiohttp-openmetrics
ENV BRZ_PLUGINS_AT=debian@/code/breezy-debian
ENV PYTHONPATH=/code:/code/breezy:/code/dulwich:/code/debmutate:/code/silver-platter:/code/upstream-ontologist:/code/buildlog-consultant:/code/ognibuild:/code/lintian-brush
ADD . /code
RUN make -C /code
