{% extends "layout.html" %}
{% import "macros/util.html" as util %}

{% block page_title %}Home{% endblock %}

{% block sidebar %}
    {% include "generic/sidebar.html" %}
{% endblock %}

{% block body %}
<div class="home-page">
    <h1>Welcome to Janitor</h1>
    <p class="lead">
        The Janitor is an automated system for making and proposing changes to version control repositories.
    </p>
    
    {% if suites %}
    <div class="suites-section">
        <h2>Available Suites</h2>
        <div class="suites-grid">
            {% for suite in suites %}
            <div class="suite-card">
                <h3><a href="/{{ suite.name }}">{{ suite.description }}</a></h3>
                <p>{{ suite.summary }}</p>
                <div class="suite-stats">
                    <span>{{ suite.codebase_count }} codebases</span>
                    <span>{{ suite.active_runs }} active runs</span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <div class="stats-section">
        <h2>Platform Statistics</h2>
        <div class="stats-grid">
            <div class="stat-card">
                <h4>Total Codebases</h4>
                <p class="stat-value">{{ total_codebases | default(value=0) }}</p>
            </div>
            <div class="stat-card">
                <h4>Active Runs</h4>
                <p class="stat-value">{{ active_runs | default(value=0) }}</p>
            </div>
            <div class="stat-card">
                <h4>Merge Proposals</h4>
                <p class="stat-value">{{ merge_proposals | default(value=0) }}</p>
            </div>
            <div class="stat-card">
                <h4>Changes Applied</h4>
                <p class="stat-value">{{ changes_applied | default(value=0) }}</p>
            </div>
        </div>
    </div>
    
    <div class="recent-activity">
        <h2>Recent Activity</h2>
        {% if recent_runs %}
        <table class="activity-table">
            <thead>
                <tr>
                    <th>Codebase</th>
                    <th>Campaign</th>
                    <th>Status</th>
                    <th>Time</th>
                </tr>
            </thead>
            <tbody>
                {% for run in recent_runs %}
                <tr>
                    <td>{{ util::link_to_codebase(codebase=run.codebase, suite=run.suite) }}</td>
                    <td>{{ run.campaign }}</td>
                    <td>{{ util::status_badge(status=run.status) }}</td>
                    <td>{{ util::format_timestamp(timestamp=run.finish_time) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>No recent activity to show.</p>
        {% endif %}
    </div>
</div>
{% endblock %}